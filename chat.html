<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>リアルタイムチャット</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "ここに自分のAPIキー",
  authDomain: "ここに自分のauthDomain",
  databaseURL: "ここに自分のdatabaseURL",
  projectId: "ここに自分のprojectId",
  storageBucket: "ここに自分のstorageBucket",
  messagingSenderId: "ここに自分のsenderId",
  appId: "ここに自分のappId"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userName = localStorage.getItem("chatName");

if(!userName){
  userName = prompt("名前を入力してください");
  if(userName){
    localStorage.setItem("chatName", userName);
  } else {
    userName = "ゲスト";
  }
}

window.sendMessage = function(){
  const text = document.getElementById("message").value;
  if(!text) return;

  push(ref(db, "messages"), {
    name: userName,
    text: text,
    time: Date.now()
  });

  document.getElementById("message").value = "";
};

onChildAdded(ref(db, "messages"), (snapshot) => {
  const data = snapshot.val();
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.classList.add("message");

  if(data.name === userName){
    div.classList.add("right");
  } else {
    div.classList.add("left");
  }

  div.textContent = data.name + " : " + data.text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
});
</script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:#e5ddd5;
  display:flex;
  flex-direction:column;
  height:100vh;
}

header{
  background:#06c755;
  color:white;
  text-align:center;
  padding:15px;
}

#chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
  display:flex;
  flex-direction:column;
}

.message{
  max-width:70%;
  padding:8px 12px;
  margin:5px 0;
  border-radius:15px;
}

.left{
  align-self:flex-start;
  background:white;
}

.right{
  align-self:flex-end;
  background:#06c755;
  color:white;
}

.input-area{
  display:flex;
  padding:10px;
  background:white;
}

input{
  flex:1;
  padding:10px;
  margin-right:5px;
}

button{
  padding:10px;
  background:#06c755;
  color:white;
  border:none;
}
</style>
</head>

<body>

<header>オンラインチャット</header>

<div id="chat"></div>

<div class="input-area">
  <input id="message" placeholder="メッセージ">
  <button onclick="sendMessage()">送信</button>
</div>

</body>
</html>
